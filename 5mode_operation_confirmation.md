# RDEToolKitãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã¤ã„ã¦

## ç›®çš„
- RDEToolKitã«ç”¨æ„ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ç™»éŒ²ã®5ãƒ¢ãƒ¼ãƒ‰ãã‚Œãã‚Œã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æä¾›ã—ã¾ã™
- å„ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰ã‚’å®Ÿéš›ã«å‹•ä½œã•ã›ãªãŒã‚‰èª¬æ˜ã—ã¾ã™
- ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰ã¯RDEã«ï¼‘ã¤ã¾ãŸã¯è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã™ã‚‹ãŸã‚ã®æ•°ç¨®é¡ã®æ–¹æ³•ã‚’æä¾›ã—ã¾ã™
- ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ã®å½¢æ…‹ã«åˆã‚ã›ã¦å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã€å‡ºåŠ›å…ˆã‚’åˆæœŸé…ç½®ã™ã‚‹æ©Ÿèƒ½ã§ã™
- ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™
  1. Invoice mode
    - 1å›ã®ç™»éŒ²ã§1ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã§ãã‚‹
  2. ExcelInvoice mode
    - 1å›ã®ç™»éŒ²ã§è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã§ãã‚‹
    - ç™»éŒ²ãƒ•ã‚¡ã‚¤ãƒ«ã€é€çŠ¶é …ç›®ã‚’ã‚¨ã‚¯ã‚»ãƒ«å½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§æŒ‡å®š
    - é€çŠ¶é …ç›®ã‚’ã¾ã¨ã‚ã¦å…¥åŠ›ã§ãã‚‹
  3. SmartTableInvoice mode
    - 1å›ã®ç™»éŒ²ã§è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã§ãã‚‹
    - Excelinvoiceã‚’ã‚ˆã‚Šä½¿ã„ã‚„ã™ãã—ãŸã‚‚ã®
    - ç™»éŒ²ãƒ•ã‚¡ã‚¤ãƒ«ã€é€çŠ¶é …ç›®ã‚’CSVã€TSVã€ã‚¨ã‚¯ã‚»ãƒ«å½¢å¼ã®ã„ãšã‚Œã‹ã®ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§æŒ‡å®š
    - é€çŠ¶é …ç›®ã‚’ã¾ã¨ã‚ã¦å…¥åŠ›ã§ãã‚‹
  4. MultiDataTile mode
    - 1å›ã®ç™»éŒ²ã§è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã§ãã‚‹
    - ãŸã ã—é€çŠ¶é …ç›®ã¯åŒä¸€
  5. RDEFormat mode
    - æ§‹é€ åŒ–å‡¦ç†æ¸ˆã¿ã®RDEformatå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ä¸€å¼ã‚’å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã™ã‚‹
    - 1å›ã®ç™»éŒ²ã§1ä»¶ã¾ãŸã¯è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã§ãã‚‹
- ã“ã®è³‡æ–™ã§ã¯æä¾›ã—ã¦ã„ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ã‚ãšã«å„ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦æ§‹é€ åŒ–å‡¦ç†ã®æº–å‚™ã‚’è¡Œã†æ‰‹é †ã‚’èª¬æ˜ã—ã¾ã™
- æä¾›ã—ã¦ã„ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’åˆ©ç”¨ã«ã¤ã„ã¦ã¯å„readme.mdã‚’å‚ç…§ã—ã¦ãã ã•ã„
- ãªãŠã€ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰ã®å‹•ä½œã®è§£èª¬ã‚’å¯¾è±¡ã¨ã—ã¦ã„ã‚‹ãŸã‚ã€æ§‹é€ åŒ–å‡¦ç†ã«ã¤ã„ã¦ã¯å®Ÿè£…ã—ã¦ã„ã¾ã›ã‚“
- SmartTableInvoiceãƒ¢ãƒ¼ãƒ‰ã¯RDEToolKit v1.3ä»¥é™ã§åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸ

## æä¾›ã—ã¦ã„ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
1. Invoice mode
  - [Invoice modeç”¨ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ](DatasetTemplates/mode_invoice/)
2. ExcelInvoice mode
  - [ExcelInvoice modeç”¨ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ](DatasetTemplates/mode_excelinvoice/)
3. SmartTableInvoice mode
  - [SmartTableInvoice modeç”¨ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ](DatasetTemplates/mode_smarttableinvoice/)
4. MultiDataTile mode
  - [MultiDataTile modeç”¨ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ](DatasetTemplates/mode_multidatatile//)
5. RDEFromat mode
  - [RDEFormat modeç”¨ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ](DatasetTemplates/mode_rdeformat/)

## å§‹ã‚ã‚‹å‰ã«

ä»¥é™ã§ã¯å„ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰ã«å¯¾å¿œã—ãŸå‡¦ç†ã‚’æ‰‹ä½œæ¥­ã§ä½œã£ã¦ã„ãæ‰‹é †ã‚’èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚RDEToolKitã®ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰ã‚’å‹•ä½œã•ã›ãªãŒã‚‰èª¬æ˜ã—ã¦ã„ã¾ã™ã®ã§ã”èˆˆå‘³ã®ã‚ã‚‹æ–¹ã¯è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

å‹•ä½œç’°å¢ƒã¨ã—ã¦ä»¥ä¸‹ã‚’ç”¨æ„ã—ã¦ãã ã•ã„ã€‚

1. Windowsã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯WSLã§Ubuntu 24.04ä»¥ä¸Š
2. python v3.13ä»¥ä¸Š
3. RDEToolKit v.1.3.4ä»¥é™(pipã§å°å…¥)

## Invoice mode

![data flow in Invoice mode](docs/images/invoice_mode_dataflow.png "data flow in Invoice mode")

å‚ç…§: [RDEToolKit Documentation Invoiceãƒ¢ãƒ¼ãƒ‰ã¨ã¯](https://nims-mdpf.github.io/rdetoolkit/usage/mode/mode_invoice/)

- `Invoice mode`ã¯ã€1å›ã®ãƒ‡ãƒ¼ã‚¿ç™»éŒ²(ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ã‚¢ãƒ—ãƒªã®é€çŠ¶ç”»é¢1ã¤)ã§1ä»¶ã®ãƒ‡ãƒ¼ã‚¿(ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ«)ã¨ã—ã¦ç™»éŒ²ã™ã‚‹éš›ã«åˆ©ç”¨ã—ã¾ã™
- `1ç™»éŒ²ã§1ãƒ‡ãƒ¼ã‚¿`ã§ã™
- æä¾›ã—ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã€DatasetTemplates/mode_invoiceã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä½¿ã£ã¦ãã ã•ã„
- ã“ã“ã§ã¯RDEToolKitã‚’ä½¿ã£ã¦åˆæœŸåŒ–ã™ã‚‹ã¨ã“ã‚ã‹ã‚‰é †ã‚’è¿½ã£ã¦èª¬æ˜ã—ã¦ã„ã¾ã™(åˆã‚ã‹ã‚‰ä½œã£ã¦ã¿ãŸã„äººã¯æ˜¯éã«)
- æœ€çµ‚çš„ã«ã§ãã‚ãŒã‚‹ã‚‚ã®ã¯ DatasetTemplates/mode_invoice ã¨åŒã˜å†…å®¹ã§ã™
- ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ã®ã‚µãƒ³ãƒ—ãƒ«ã¯DatasetTemplates/mode_invoice/input/inputdataã«ã‚ã‚Šã¾ã™
- docker containerã‚’ä½¿ã£ã¦å®Ÿè¡Œã—ãŸã„æ–¹ã¯mode_invoiceã®readme.mdã‚’å‚ç…§ã—ã¦ãã ã•ã„

### æº–å‚™

1. ä½œæ¥­ç”¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€ã“ã“ã‚’ãƒ¯ãƒ¼ã‚¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ã—ã¾ã™ã€‚
    ```cmd
    $ mkdir mode_invoice
    $ cd mode_invoice
    ```
2. RDEToolKitã‚’ä½¿ã£ã¦æ§‹é€ åŒ–å‡¦ç†ã®é››å½¢ã‚’ç”¨æ„ã™ã‚‹<br >ä¸‹è¨˜ã®ã‚ˆã†ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ•ã‚¡ã‚¤ãƒ«ãŒé…ç½®ã•ã‚Œã¾ã™
    ```cmd
    mode_invoice $ python -m rdetoolkit init
    Ready to develop a structured program for RDE.
    Created: mode_invoice/container/requirements.txt
    Created: mode_invoice/container/Dockerfile
    Created: mode_invoice/container/data/invoice/invoice.json
    Created: mode_invoice/container/data/tasksupport/invoice.schema.json
    Created: mode_invoice/container/data/tasksupport/metadata-def.json
    Created: mode_invoice/templates/tasksupport/invoice.schema.json
    Created: mode_invoice/templates/tasksupport/metadata-def.json
    Created: mode_invoice/input/invoice/invoice.json

    Check the folder: mode_invoice
    Done!
    ```
3. ãƒ¯ãƒ¼ã‚¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’containerã«å¤‰æ›´
    ```cmd
    mode_invoice $ cd container
    ```
4. å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã—ã¾ã™<br>ãƒ‡ãƒ¼ã‚¿ãƒ‘ãƒ¼ã‚¹ã¯ã—ãªã„ãŸã‚ã‚µã‚¤ã‚ºãŒ0ãƒã‚¤ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ã„ã¾ã™<br>ä»–ã®ãƒ¢ãƒ¼ãƒ‰ã¨ã®æ¯”è¼ƒãŸã‚ã€å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’3ã¤ä½œã£ã¦ã„ã¾ã™ã€‚ã“ã®3ãƒ•ã‚¡ã‚¤ãƒ«ã‚’1ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ç™»éŒ²ã—ã¾ã™ã€‚
    ```cmd
    container $ mkdir -p data/inputdata
    container $ touch data/inputdata/data000.dat
    container $ touch data/inputdata/data001.dat
    container $ touch data/inputdata/data002.dat
    ```
5. ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å…¥åŠ›<br>`main.py`ã‚’containerä»¥ä¸‹ã«ä½œæˆ<br>ä»¥ä¸‹ã®å†…å®¹ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«è»¢è¨˜ã—ã¦ä¿å­˜
    ```python
    import rdetoolkit
    from modules import datasets_process

    rdetoolkit.workflows.run(custom_dataset_function=datasets_process.dataset)
    ```
5. ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å…¥åŠ›<br>`datasets_process.py`ã‚’container/modulesä»¥ä¸‹ã«ä½œæˆ<br>ä»¥ä¸‹ã®å†…å®¹ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«è»¢è¨˜ã—ã¦ä¿å­˜
    ```python
    from rdetoolkit.errors import catch_exception_with_message
    from rdetoolkit.models.rde2types import RdeInputDirPaths, RdeOutputResourcePath

    @catch_exception_with_message(error_message="ERROR: failed in data processing")
    def dataset(srcpaths: RdeInputDirPaths, resource_paths: RdeOutputResourcePath) -> None:
        # å„ãƒ‡ãƒ¼ã‚¿å˜ä½ã®å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€è¦§ã‚’å‡ºåŠ›
        print(resource_paths.rawfiles)
    ```


ä»¥ä¸Šã§æº–å‚™ã¯å®Œäº†ã§ã™ã€‚

Invoice modeã§æœ€ä½é™å‹•ã‹ã™å ´åˆã¯ä¸Šè¨˜ã®ã‚ˆã†ãªæ§‹æˆã§è¶³ã‚Šã¾ã™ã€‚

### å‹•ã‹ã—ã¦ã¿ã‚‹

ã§ã¯ã€å®Ÿéš›ã«å‹•ã‹ã—ã¦ã¿ã¾ã™ã€‚

å®Ÿè¡Œå‰ã¨å®Ÿè¡Œå¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã®é…ç½®ã‚’æ¯”è¼ƒã™ã‚‹ãŸã‚ã€ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã‚’ã¿ãªãŒã‚‰é€²ã‚ã¾ã™ã€‚

å®Ÿè¡Œå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
```cmd
container $ treeã€€data
data
â”œâ”€â”€ inputdata
â”‚   â”œâ”€â”€ data000.dat
â”‚   â”œâ”€â”€ data001.dat
â”‚   â””â”€â”€ data002.dat
â”œâ”€â”€ invoice
â”‚   â””â”€â”€ invoice.json
â””â”€â”€ tasksupport
    â”œâ”€â”€ invoice.schema.json
    â””â”€â”€ metadata-def.json
```

å®Ÿè¡Œä¸­ ã‚¨ãƒ©ãƒ¼ãŒãªãã€ä¸‹è¨˜ã®ã‚ˆã†ã«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®ä¸€è¦§ãŒå‡ºåŠ›ã•ã‚ŒãŸã‚‰æ­£å¸¸çµ‚äº†ã§ã™ã€‚
```cmd
container $ python main.py
(PosixPath('data/inputdata/data001.dat'), PosixPath('data/inputdata/data000.dat'), PosixPath('data/inputdata/data002.dat'))
container $
```

å®Ÿè¡Œå¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
```cmd
container $ tree data
data
â”œâ”€â”€ attachment
â”œâ”€â”€ inputdata
â”‚   â”œâ”€â”€ data000.dat
â”‚   â”œâ”€â”€ data001.dat
â”‚   â””â”€â”€ data002.dat
â”œâ”€â”€ invoice
â”‚   â””â”€â”€ invoice.json
â”œâ”€â”€ invoice_patch
â”œâ”€â”€ logs
â”œâ”€â”€ main_image
â”œâ”€â”€ meta
â”œâ”€â”€ nonshared_raw
â”‚   â”œâ”€â”€ data000.dat
â”‚   â”œâ”€â”€ data001.dat
â”‚   â””â”€â”€ data002.dat
â”œâ”€â”€ other_image
â”œâ”€â”€ raw
â”œâ”€â”€ structured
â”œâ”€â”€ tasksupport
â”‚   â”œâ”€â”€ invoice.schema.json
â”‚   â””â”€â”€ metadata-def.json
â”œâ”€â”€ temp
â””â”€â”€ thumbnail
```

### å®Ÿè¡Œå¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã‚’ã¿ãªãŒã‚‰RDEToolKitã®ãƒ¢ãƒ¼ãƒ‰ã®å½¹å‰²ã«ã¤ã„ã¦èª¬æ˜
- å®Ÿè¡Œå‰ã¨å®Ÿè¡Œå¾Œã¨ã®ãƒ•ã‚¡ã‚¤ãƒ«é…ç½®ã®é•ã„ã‚’ç¢ºèªã—ã¦ãã ã•ã„
- å®Ÿè¡Œå¾Œã«æ–°ãŸã«ä½œæˆã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒã„ãã¤ã‹ã‚ã‚Šã¾ã™(structured,main_image,other_imageã€metaãªã©)
  - å„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®èª¬æ˜ã¯[ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¿ãƒƒãƒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ doc1](https://github.com/nims-mdpf/RDE_Docs_firsttouch/tree/main/doc1)ã‚’å‚ç…§ã—ã¦ãã ã•ã„
- ç‰¹ã«rawã€nonshared_rawã«æ³¨ç›®ã—ã¦ãã ã•ã„
  - RDEToolKitã‚’ç”¨ã„ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã¯ã€å®Ÿè¡Œå¾Œã¯inputdataã«é…ç½®ã•ã‚ŒãŸå…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¯æ¨™æº–ã§ã¯nonshared_rawã«é…ç½®ã•ã‚Œã¾ã™
  - rawãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚¨ãƒ³ãƒãƒ¼ã‚´æœŸé–“çµ‚äº†å¾Œã«å…¬é–‹ã•ã‚Œã¾ã™
  - nonshared_rawã«é…ç½®ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚¨ãƒ³ãƒãƒ¼ã‚´æœŸé–“çµ‚äº†å¾Œã‚‚éå…¬é–‹ã¨ãªã‚Šã¾ã™
- inputdataã«é…ç½®ã•ã‚ŒãŸ3ãƒ•ã‚¡ã‚¤ãƒ«ãŒnonshared_rawã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã“ã‚ŒãŒRDEToolKitã®ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰ã®å‡¦ç†ã«ã‚ˆã‚‹ã‚‚ã®ã§ã™
  - ã“ã®ã‚ˆã†ã«RDEToolKitã§ã¯ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰ã«åˆã‚ã›ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆæœŸé…ç½®ã—ã¾ã™
  - ã“ã®é…ç½®ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ‘ãƒ¼ã‚¹(ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚„æ•°å€¤ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã™)ãªã©ã®æ§‹é€ åŒ–å‡¦ç†ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã™ã‚‹ã®ãŒé–‹ç™ºè€…ã®ä½œæ¥­ã¨ãªã‚Šã¾ã™


### ä½™è«‡ã€€srcpaths: RdeInputDirPaths, resource_paths: RdeOutputResourcePathã«ã¤ã„ã¦

- ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰ã«å¾“ã£ã¦é…ç½®ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ‘ã‚¹ã¯ã€RdeInputDirPathsã€RdeOutputResourcePath(ã“ã‚Œã‚‰ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹)ã«ä¿æŒã•ã‚Œã¾ã™
- å…ˆã®Invoice modeã§å®Ÿè¡Œã—ã¨ãã®å„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å€¤ã‚’ã¿ã¦ã¿ã¾ã™

srcpaths: RdeInputDirPaths
```python
RdeInputDirPaths(
    inputdata=PosixPath('data/inputdata'),
    invoice=PosixPath('data/invoice'),
    tasksupport=PosixPath('data/tasksupport'), 
    config=Config(
        system=SystemSettings(extended_mode=None, save_raw=False, save_nonshared_raw=True, save_thumbnail_image=False, magic_variable=False),
        multidata_tile=MultiDataTileSettings(ignore_errors=False),
        smarttable=None
    )
)
```

resource_paths: RdeOutputResourcePath
```python
RdeOutputResourcePath(
    raw=PosixPath('data/raw'),
    nonshared_raw=PosixPath('data/nonshared_raw'),
    rawfiles=(PosixPath('data/inputdata/data001.dat'),
              PosixPath('data/inputdata/data000.dat'),
              PosixPath('data/inputdata/data002.dat')),
    struct=PosixPath('data/structured'),
    main_image=PosixPath('data/main_image'),
    other_image=PosixPath('data/other_image'),
    meta=PosixPath('data/meta'), thumbnail=PosixPath('data/thumbnail'),
    logs=PosixPath('data/logs'), invoice=PosixPath('data/invoice'),
    invoice_schema_json=PosixPath('data/tasksupport/invoice.schema.json'),
    invoice_org=PosixPath('data/invoice/invoice.json'),
    temp=PosixPath('data/temp'),
    invoice_patch=PosixPath('data/invoice_patch'),
    attachment=PosixPath('data/attachment')
)
```

- å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ‘ãƒ¼ã‚¹ã™ã‚‹éš›ã¯ã€resource_paths.rawfilesã«ã‚ˆã£ã¦ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™
- æ§‹é€ åŒ–å‡¦ç†ã®çµæœã‚’å‡ºåŠ›ã™ã‚‹å ´åˆã¯ã€resource_paths.structãªã©ã‚’æ›¸ãè¾¼ã¿å…ˆã¨ã—ã¦æŒ‡å®šã—ã¾ã™

## ExcelInvoice mode

![data flow in ExcelInvoice mode](docs/images/excelinvoice_mode_dataflow.png "data flow in ExcelInvoice mode")

å‚ç…§: [RDEToolKit Documentation ExcelInvoiceãƒ¢ãƒ¼ãƒ‰ã¨ã¯](https://nims-mdpf.github.io/rdetoolkit/usage/mode/mode_excelinvoice/)
- `ExcelInvoice mode`ã¯ã€1å›ã®ãƒ‡ãƒ¼ã‚¿ç™»éŒ²(ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ã‚¢ãƒ—ãƒªã®é€çŠ¶ç”»é¢1ã¤)ã§è¤‡æ•°ä»¶ã®ãƒ‡ãƒ¼ã‚¿(ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ«)ã¨ã—ã¦ç™»éŒ²ã™ã‚‹éš›ã«åˆ©ç”¨ã—ã¾ã™
- ç™»éŒ²ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã€é€çŠ¶ã®å…¥åŠ›é …ç›®ã¯ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹(ã‚¨ã‚¯ã‚»ãƒ«å½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«(*_excel_invoice.xlsx))ã«æ›¸ãè¾¼ã¿ã¾ã™
- ã¾ãŸã€ç™»éŒ²ãƒ•ã‚¡ã‚¤ãƒ«ã¯zipå½¢å¼ã§ï¼‘ã¤ã«ã¾ã¨ã‚ã¦ç™»éŒ²ã—ã¾ã™
- ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¾ã¨ã‚ã‹ãŸã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¢ãƒ¼ãƒ‰ã€ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ãƒ¢ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã™
  - ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¢ãƒ¼ãƒ‰ : ç™»éŒ²ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«(1ãƒ‡ãƒ¼ã‚¿1ãƒ•ã‚¡ã‚¤ãƒ«)ä¸€å¼ã‚’zipå½¢å¼ã§ã¾ã¨ã‚ã¾ã™
  - ãƒ•ã‚©ãƒ«ãƒ€ãƒ¢ãƒ¼ãƒ‰ : ç™»éŒ²ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¤‡æ•°ã®çµ„ã¿åˆã‚ã›ã®å ´åˆã«åˆ©ç”¨ã€‚ãƒ•ã‚©ãƒ«ãƒ€å˜ä½ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã¾ã¨ã‚ã¦ãŠãã€ãƒ•ã‚©ãƒ«ãƒ€ã”ã¨zipå½¢å¼ã§ã¾ã¨ã‚ã¾ã™
- `1ç™»éŒ²ã§è¤‡æ•°ãƒ‡ãƒ¼ã‚¿`ã§ã€1ãƒ‡ãƒ¼ã‚¿ã”ã¨ã«`é€çŠ¶ã®å†…å®¹ã‚’å¤‰ãˆã‚‰ã‚Œã¾ã™`
- æä¾›ã—ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã€DatasetTemplates/mode_excelinvoiceã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä½¿ã£ã¦ãã ã•ã„
- ã“ã“ã§ã¯RDEToolKitã‚’ä½¿ã£ã¦åˆæœŸåŒ–ã™ã‚‹ã¨ã“ã‚ã‹ã‚‰é †ã‚’è¿½ã£ã¦èª¬æ˜ã—ã¦ã„ã¾ã™(åˆã‚ã‹ã‚‰ä½œã£ã¦ã¿ãŸã„äººã¯æ˜¯éã«)
- æœ€çµ‚çš„ã«ã§ãã‚ãŒã‚‹ã‚‚ã®ã¯ DatasetTemplates/mode_excelinvoice ã¨åŒã˜å†…å®¹ã§ã™
- ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ã®ã‚µãƒ³ãƒ—ãƒ«ã¯mode_excelinvoice/inputã«ã‚ã‚Šã¾ã™
  - ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¢ãƒ¼ãƒ‰ : mode_excelinvoice/input/file_mode
  - ãƒ•ã‚©ãƒ«ãƒ€ãƒ¢ãƒ¼ãƒ‰ : mode_excelinvoice/input/folder_mode
- docker containerã‚’ä½¿ã£ã¦å®Ÿè¡Œã—ãŸã„æ–¹ã¯mode_excelinvoice/readme.mdã‚’å‚ç…§ã—ã¦ãã ã•ã„
- ä»¥ä¸‹ã®èª¬æ˜ã§ã¯ãƒ•ã‚©ãƒ«ãƒ€ãƒ¢ãƒ¼ãƒ‰ã«ã¤ã„ã¦èª¬æ˜ã—ã¦ã„ã¾ã™

### æº–å‚™

æ–°ãŸã«ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ç”¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—é››å½¢ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™

```cmd
$ mkdir mode_excelinvoice
$ cd  mode_excelinvoice
mode_excelinvoice $ python -m rdetoolkit init
mode_excelinvoice $ cd container
container $
```

ã•ã‚‰ã«ã€main.pyã¨datasets_process.pyã‚’Invoice modeã¨åŒã˜å†…å®¹ã§ãã‚Œãã‚Œæ‰€å®šã®ãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®ã—ã¾ã™ã€‚

å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æº–å‚™ã—ã¾ã™ã€‚
data000.datã€data001.datã€data002.datã‚’ãã‚Œãã‚Œãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ç™»éŒ²ã—ã¾ã™ã€‚1å›ã®ç™»éŒ²ã§3ãƒ‡ãƒ¼ã‚¿ãŒç™»éŒ²ã•ã‚Œã¾ã™ã€‚
```cmd
container $ touch data000.dat
container $ touch data001.dat
container $ touch data002.dat
container $ zip data.zip data???.dat
  adding: data000.dat (stored 0%)
  adding: data001.dat (stored 0%)
  adding: data002.dat (stored 0%)
container $ cp data.zip data/inputdata
```

ä»¥ä¸‹ã¯ãƒ•ã‚©ãƒ«ãƒ€ãƒ¢ãƒ¼ãƒ‰ã®ã¨ãã®zipãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œã‚Šæ–¹ã®äº‹ä¾‹ã§ã™
```
$ zip -r data.zip data000 data001 data002 
  adding: data000/ (stored 0%)
  adding: data000/data000.dat (stored 0%)
  adding: data001/ (stored 0%)
  adding: data001/data001.dat (stored 0%)
  adding: data002/ (stored 0%)
  adding: data002/data002.dat (stored 0%)
```

### RDEToolKitã§excelinvoiceãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹

- å…ˆã«è©¦ã—ãŸinvoiceãƒ¢ãƒ¼ãƒ‰ã‚’excelinvoiceãƒ¢ãƒ¼ãƒ‰ã«å¤‰æ›´ã—ã¦ã¿ã¾ã™
- RDEToolKitã«ã¯invoice.schema.jsonã‹ã‚‰ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®é››å½¢ã‚’ä½œæˆã™ã‚‹æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™
- ãªãŠã€ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ç”¨ã„ã‚‹Excelãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ•ã‚¡ã‚¤ãƒ«åã®æœ«å°¾ãŒ`_excel_invoice.xlsx`ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

```cmd 
container $ python -m rdetoolkit --help
Usage: python -m rdetoolkit [OPTIONS] COMMAND [ARGS]...

  CLI generates template projects for RDE structured programs.

Options:
  --help  Show this message and exit.

Commands:
  artifact           Create an artifact (.zip) for submission to RDE by...
  init               Output files needed to build RDE structured programs.
  make-excelinvoice  Generate an Excel invoice based on the provided...
  version            Command to display version.
```

tasksupportã«å«ã¾ã‚Œã‚‹invoice.schema.jsonã‹ã‚‰ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«(xlsx)ã‚’ä½œæˆã™ã‚‹
```cmd 
container $ python -m rdetoolkit make-excelinvoice ./data/tasksupport/invoice.schema.json 
ğŸ“„ Generating ExcelInvoice template...
- Schema: mode_excelinvoice/container/data/tasksupport/invoice.schema.json
- Output: mode_excelinvoice/container/template_excel_invoice.xlsx
- Mode: file
âœ¨ ExcelInvoice template generated successfully! : mode_excelinvoice/container/template_excel_invoice.xlsx
```

ã§ããŸã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¾ã™ã€‚

ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ã‚·ãƒ¼ãƒˆã®è¨˜è¼‰ã¨ã®å·®ç•°ãŒã‚ã‚Šã¾ã™ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ã«å…¥åŠ›ã—ã¾ã™ã€‚

- ãƒ•ã‚¡ã‚¤ãƒ«åæ¬„ã®å„è¡Œã«ã€zipãƒ•ã‚¡ã‚¤ãƒ«ã«ã¾ã¨ã‚ãŸï¼“ãƒ•ã‚¡ã‚¤ãƒ«data000.datã€data001.datã€data002.datã‚’ãã‚Œãã‚Œå…¥åŠ›
- NIMS user UUIDã®å„è¡Œã« 119cae3d3612df5f6cf7085fb8deaa2d1b85ce963536323462xxxxxx ã‚’å…¥åŠ›
- è©¦æ–™åæ¬„ã®å„è¡Œã«ã€è©¦æ–™0ã€è©¦æ–™1ã€è©¦æ–™2ã‚’ãã‚Œãã‚Œå…¥åŠ›
- è©¦æ–™ç®¡ç†è€…UUIDã®å„è¡Œã« 119cae3d3612df5f6cf7085fb8deaa2d1b85ce963536323462xxxxxx ã‚’å…¥åŠ›
- ãƒˆã‚¤ãƒ‡ãƒ¼ã‚¿1ã®å„è¡Œã«ã€é©å®œæ–‡å­—åˆ—ã‚’å…¥åŠ›
- ãƒˆã‚¤ãƒ‡ãƒ¼ã‚¿2ã®å„è¡Œã«ã€é©å®œæ•°å€¤ã‚’å…¥åŠ›
- ä»¥ä¸Šã¯ã“ã®èª¬æ˜ã®ãŸã‚ã®å…¥åŠ›ã§ã‚ã‚Šå®Ÿéš›ã®å…¥åŠ›é …ç›®ã‚„åˆ¶é™ã¯ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã”ã¨ã«ç•°ãªã‚Šã¾ã™
- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¢ãƒ¼ãƒ‰ã¨ãƒ•ã‚©ãƒ«ãƒ€ãƒ¢ãƒ¼ãƒ‰
  - ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¢ãƒ¼ãƒ‰ : A2ã‚»ãƒ«ã«ã€€`data_file_names` ã€A3ã‚»ãƒ«ã« `name` ã¨å…¥åŠ›ã—ã¾ã™
  - ãƒ•ã‚©ãƒ«ãƒ€ãƒ¢ãƒ¼ãƒ‰ : A2ã‚»ãƒ«ã«ã€€`data_folder`ã€€ã¨å…¥åŠ›ã—ã¾ã™


ç·¨é›†ãŒçµ‚ã‚ã£ãŸã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’inputdataã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™
```
container $ cp template_excel_invoice.xlsx data/inputdata/
```

ãã‚Œã§ã¯å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ã¾ãšã¯å®Ÿè¡Œå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã®ç¢ºèª
```
container $ tree data
data
â”œâ”€â”€ inputdata
â”‚   â”œâ”€â”€ data_mode_excel_invoice.zip
â”‚   â””â”€â”€ template_excel_invoice.xlsx
â”œâ”€â”€ invoice
â”‚   â””â”€â”€ invoice.json
â””â”€â”€ tasksupport
    â”œâ”€â”€ invoice.schema.json
    â””â”€â”€ metadata-def.json

4 directories, 5 files
```

å®Ÿè¡Œä¸­ã€€ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ãŒ1ä»¶ã¥ã¤è¨ˆ3å›å‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹ã®ã¯ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ãŒ3ã¤ã§ãã®å˜ä½ã§å®Ÿè¡Œã•ã‚ŒãŸã‹ã‚‰ã§ã™ã€‚
```cmd
container $ python main.py                                
(PosixPath('data/temp/data000.dat'),)
(PosixPath('data/temp/data001.dat'),)
(PosixPath('data/temp/data002.dat'),)
container $
```

### å®Ÿè¡Œå¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã‚’ã¿ãªãŒã‚‰RDEToolKitã®ãƒ¢ãƒ¼ãƒ‰ã®å½¹å‰²ã«ã¤ã„ã¦èª¬æ˜

ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã®è¦ç‚¹
- 3ã¤ã®å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãŒã€dataç›´ä¸‹(ã«1ãƒ‡ãƒ¼ã‚¿)ã¨dividedä»¥ä¸‹(ï¼’ä»¶ç›®ä»¥é™ã®ãƒ‡ãƒ¼ã‚¿)ã«åˆ†ã‹ã‚Œã¦é…ç½®ã•ã‚Œã‚‹
- ãã‚Œãã‚Œã®invoice.jsonãŒã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ã®å€¤ã«ç½®ãæ›ã‚ã£ã¦ã„ã‚‹
- ä»¥ä¸ŠãŒã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã®å½¹å‰²ã§ã™
- datasets_process.pyã®dataseté–¢æ•°ã®å‡¦ç†ãŒãƒ‡ãƒ¼ã‚¿æ•°åˆ†ç¹°ã‚Šè¿”ã•ã‚Œã¦ã„ã‚‹
  - dataseté–¢æ•°ãŒ3å›å®Ÿè¡Œ
  - ã¤ã¾ã‚Šã€dataseté–¢æ•°ã«æ›¸ã„ãŸå‡¦ç†ãŒãƒ‡ãƒ¼ã‚¿æ•°åˆ†ç¹°ã‚Šè¿”ã•ã‚Œã¾ã™
  - ã“ã‚Œã¯RDEToolKitãŒãƒ‡ãƒ¼ã‚¿æ•°åˆ†ç¹°ã‚Šè¿”ã™ã‚ˆã†ã«ä½œã‚‰ã‚Œã¦ã„ã‚‹ã‹ã‚‰ã§ã™

å®Ÿè¡Œå¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
```
container $ tree data
data
â”œâ”€â”€ attachment
â”œâ”€â”€ divided
â”‚   â”œâ”€â”€ 0001
â”‚   â”‚   â”œâ”€â”€ attachment
â”‚   â”‚   â”œâ”€â”€ invoice
â”‚   â”‚   â”‚   â””â”€â”€ invoice.json
â”‚   â”‚   â”œâ”€â”€ invoice_patch
â”‚   â”‚   â”œâ”€â”€ logs
â”‚   â”‚   â”œâ”€â”€ main_image
â”‚   â”‚   â”œâ”€â”€ meta
â”‚   â”‚   â”œâ”€â”€ nonshared_raw
â”‚   â”‚   â”‚   â””â”€â”€ data001.dat
â”‚   â”‚   â”œâ”€â”€ other_image
â”‚   â”‚   â”œâ”€â”€ raw
â”‚   â”‚   â”œâ”€â”€ structured
â”‚   â”‚   â”œâ”€â”€ temp
â”‚   â”‚   â””â”€â”€ thumbnail
â”‚   â””â”€â”€ 0002
â”‚       â”œâ”€â”€ attachment
â”‚       â”œâ”€â”€ invoice
â”‚       â”‚   â””â”€â”€ invoice.json
â”‚       â”œâ”€â”€ invoice_patch
â”‚       â”œâ”€â”€ logs
â”‚       â”œâ”€â”€ main_image
â”‚       â”œâ”€â”€ meta
â”‚       â”œâ”€â”€ nonshared_raw
â”‚       â”‚   â””â”€â”€ data002.dat
â”‚       â”œâ”€â”€ other_image
â”‚       â”œâ”€â”€ raw
â”‚       â”œâ”€â”€ structured
â”‚       â”œâ”€â”€ temp
â”‚       â””â”€â”€ thumbnail
â”œâ”€â”€ inputdata
â”‚   â”œâ”€â”€ data_mode_excel_invoice.zip
â”‚   â””â”€â”€ template_excel_invoice.xlsx
â”œâ”€â”€ invoice
â”‚   â””â”€â”€ invoice.json
â”œâ”€â”€ invoice_patch
â”œâ”€â”€ logs
â”œâ”€â”€ main_image
â”œâ”€â”€ meta
â”œâ”€â”€ nonshared_raw
â”‚   â””â”€â”€ data000.dat
â”œâ”€â”€ other_image
â”œâ”€â”€ raw
â”œâ”€â”€ structured
â”œâ”€â”€ tasksupport
â”‚   â”œâ”€â”€ invoice.schema.json
â”‚   â””â”€â”€ metadata-def.json
â”œâ”€â”€ temp
â”‚   â”œâ”€â”€ data000.dat
â”‚   â”œâ”€â”€ data001.dat
â”‚   â”œâ”€â”€ data002.dat
â”‚   â””â”€â”€ invoice_org.json
â””â”€â”€ thumbnail

42 directories, 16 files
(venv) container $ 
```


ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ã«å…¥åŠ›ã—ãŸå†…å®¹ã¨invoice.jsonã®å†…å®¹ã‚’æ¯”è¼ƒã—ã¦ã¿ã¦ãã ã•ã„ã€‚

å®Ÿè¡Œå¾Œã®å„invoice.json

data/invoice/invoice.json
```json
{
    "datasetId": "3f976089-7b0b-4c66-a035-f48773b018e6",
    "basic": {
        "dateSubmitted": "",
        "dataOwnerId": "119cae3d3612df5f6cf7085fb8deaa2d1b85ce963536323462xxxxxx",
        "dataName": "data0",
        "instrumentId": null,
        "experimentId": null,
        "description": null
    },
    "custom": {
        "toy_data1": "toydata1.data0",
        "toy_data2": null,
        "sample2": 0
    },
    "sample": {
        "sampleId": null,
        "names": [
            "è©¦æ–™0"
        ],
        "composition": null,
        "referenceUrl": null,
        "description": null,
        "generalAttributes": [],
        "specificAttributes": [],
        "ownerId": "119cae3d3612df5f6cf7085fb8deaa2d1b85ce963536323462xxxxxx"
    }
}
```

data/divided/0001
```json
{
    "datasetId": "3f976089-7b0b-4c66-a035-f48773b018e6",
    "basic": {
        "dateSubmitted": "",
        "dataOwnerId": "119cae3d3612df5f6cf7085fb8deaa2d1b85ce963536323462xxxxxx",
        "dataName": "data1",
        "instrumentId": null,
        "experimentId": null,
        "description": null
    },
    "custom": {
        "toy_data1": "toydata1.data1",
        "toy_data2": null,
        "sample2": 1
    },
    "sample": {
        "sampleId": null,
        "names": [
            "è©¦æ–™1"
        ],
        "composition": null,
        "referenceUrl": null,
        "description": null,
        "generalAttributes": [],
        "specificAttributes": [],
        "ownerId": "119cae3d3612df5f6cf7085fb8deaa2d1b85ce963536323462xxxxxx"
    }
}
```

data/divided/00002
```json
{
    "datasetId": "3f976089-7b0b-4c66-a035-f48773b018e6",
    "basic": {
        "dateSubmitted": "",
        "dataOwnerId": "119cae3d3612df5f6cf7085fb8deaa2d1b85ce963536323462xxxxxx",
        "dataName": "data2",
        "instrumentId": null,
        "experimentId": null,
        "description": null
    },
    "custom": {
        "toy_data1": "toydata1.data2",
        "toy_data2": null,
        "sample2": 2
    },
    "sample": {
        "sampleId": null,
        "names": [
            "è©¦æ–™2"
        ],
        "composition": null,
        "referenceUrl": null,
        "description": null,
        "generalAttributes": [],
        "specificAttributes": [],
        "ownerId": "119cae3d3612df5f6cf7085fb8deaa2d1b85ce963536323462xxxxxx"
    }
}
```

## SmartTableInvoice mode

![data flow in SmartTableInvoice mode](docs/images/smarttable_mode_dataflow.png "data flow in SmartTableInvoice mode")

å‚ç…§: [RDEToolKit Documentation SmartTableInvoiceãƒ¢ãƒ¼ãƒ‰ã¨ã¯](https://nims-mdpf.github.io/rdetoolkit/usage/mode/mode_smarttableinvoice)


- `SmartTableInvoice mode`ã¯ã€1å›ã®ãƒ‡ãƒ¼ã‚¿ç™»éŒ²(ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ã‚¢ãƒ—ãƒªã®é€çŠ¶ç”»é¢1ã¤)ã§è¤‡æ•°ä»¶ã®ãƒ‡ãƒ¼ã‚¿(ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ«)ã¨ã—ã¦ç™»éŒ²ã™ã‚‹éš›ã«åˆ©ç”¨ã—ã¾ã™
- `1ç™»éŒ²ã§è¤‡æ•°ãƒ‡ãƒ¼ã‚¿`ã§ã€1ãƒ‡ãƒ¼ã‚¿ã”ã¨ã«`é€çŠ¶ã®å†…å®¹ã‚’å¤‰ãˆã‚‰ã‚Œã¾ã™`
- ç™»éŒ²ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã€é€çŠ¶ã®å…¥åŠ›é …ç›®ã¯`ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«`ã«æ›¸ãè¾¼ã¿ã¾ã™
  - ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã¯Excel(xlsx)ã€CSVã€TSVã®ã„ãšã‚Œã‹ã®å½¢å¼ã§ä½œæˆã—ã¾ã™
  - ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®åç§°ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«åã«å…ˆé ­ã«`smarttable_`ã‚’å«ã‚€ã‚ˆã†ã«ã—ã¦ãã ã•ã„
- ã¾ãŸã€ç™»éŒ²ãƒ•ã‚¡ã‚¤ãƒ«ã¯zipå½¢å¼ã§ï¼‘ã¤ã«ã¾ã¨ã‚ã¦ç™»éŒ²ã—ã¾ã™
- ãƒ•ã‚¡ã‚¤ãƒ«ã®zipã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã™ã‚‹å¯¾è±¡ã¯ãƒ•ã‚©ãƒ«ãƒ€ã‚‚åˆ©ç”¨ã§ãã¾ã™
- æä¾›ã—ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã€DatasetTemplates/mode_smarttableinvoiceã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä½¿ã£ã¦ãã ã•ã„
- ã“ã“ã§ã¯RDEToolKitã‚’ä½¿ã£ã¦åˆæœŸåŒ–ã™ã‚‹ã¨ã“ã‚ã‹ã‚‰é †ã‚’è¿½ã£ã¦èª¬æ˜ã—ã¦ã„ã¾ã™(åˆã‚ã‹ã‚‰ä½œã£ã¦ã¿ãŸã„äººã¯æ˜¯éã«)
- æœ€çµ‚çš„ã«ã§ãã‚ãŒã‚‹ã‚‚ã®ã¯ DatasetTemplates/mode_smarttableinvoice ã¨åŒã˜å†…å®¹ã§ã™
- ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ã®ã‚µãƒ³ãƒ—ãƒ«ã¯mode_smarttableinvoice/inputã«ã‚ã‚Šã¾ã™
  - ãƒ•ã‚©ãƒ«ãƒ€ãªã— : mode_smarttableinvoice/input/no_folder
  - ãƒ•ã‚©ãƒ«ãƒ€ã‚ã‚Š : mode_smarttableinvoice/input/with_folder
  - å…±é€šãƒ•ã‚¡ã‚¤ãƒ« : mode_smarttableinvoice/input/common_file
- docker containerã‚’ä½¿ã£ã¦å®Ÿè¡Œã—ãŸã„æ–¹ã¯mode_smarttableinvoiceã®readme.mdã‚’å‚ç…§ã—ã¦ãã ã•ã„

### æº–å‚™

æ–°ãŸã«smarttableinvoiceç”¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—é››å½¢ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚©ãƒ«ãƒ€ãªã—ã§æŠ•å…¥ã™ã‚‹å ´åˆ(no_folder)ã®äº‹ä¾‹ã§èª¬æ˜ã—ã¾ã™ã€‚

```cmd
$ mkdir mode_smarttableinvoice
$ cd  mode_smarttableinvoice
mode_smarttableinvoice $ python -m rdetoolkit init
mode_smarttableinvoice $ cd container
container $
```

ã•ã‚‰ã«ã€main.pyã¨datasets_process.pyã‚’Invoice modeã¨åŒã˜å†…å®¹ã§ãã‚Œãã‚Œæ‰€å®šã®ãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®ã—ã¾ã™ã€‚

å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æº–å‚™ã—ã¾ã™ã€‚<br>

ã‚µãƒ³ãƒ—ãƒ«ã®å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `mode_smarttableinvoice/input/no_folder'ã‚’å‚ç…§ã€‚

data000.datã€data001.datã€data002.datã‚’ãã‚Œãã‚Œãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ç™»éŒ²ã—ã¾ã™ã€‚1å›ã®ç™»éŒ²ã§3ãƒ‡ãƒ¼ã‚¿ãŒç™»éŒ²ã•ã‚Œã¾ã™ã€‚
```cmd
container $ touch data000.dat
container $ touch data001.dat
container $ touch data002.dat
container $ zip data.zip data???.dat
  adding: data000.dat (stored 0%)
  adding: data001.dat (stored 0%)
  adding: data002.dat (stored 0%)
container $ cp data.zip data/inputdata
```

### ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹

- SmartTableInvoiceã§å…¥åŠ›ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¨é€çŠ¶é …ç›®ã®å€¤ã‚’é–¢é€£ä»˜ã‘ã¦å…¥åŠ›ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã¨å‘¼ã‚“ã§ã„ã¾ã™
- ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€`smarttable_`ã§å§‹ã¾ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«åã¨ã—ã¾ã™
- å½¢å¼ã¯ã€Excel(xlsx)ã€csvã€tsvã®ã„ãšã‚Œã‹ã¨ã—ã¾ã™
- è©³ç´°ã¯[RDEToolKitã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://nims-mdpf.github.io/rdetoolkit/usage/mode/mode_smarttableinvoice/)ã‚’å‚ç…§ã—ã¦ãã ã•ã„
- ã“ã®èª¬æ˜ã§ã¯RDEToolKitã®initã§ç”Ÿæˆã•ã‚Œã‚‹invoice.schema.jsonã«å¯¾å¿œã—ãŸãƒ†ãƒ¼ãƒ–ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®äº‹ä¾‹ã‚’ä½œæˆã—ã¾ã™


ä»¥ä¸‹ã®å†…å®¹ã®`smarttable_test.csv`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦data/inputdataã«ä¿å­˜ã—ã¾ã™ã€‚
```
# for smarttableinvoice mode
basic/dataName,inputdata1,custom/toy_data1,custom/sample2,sample/names,sample/ownerId
å®Ÿé¨“1,data000.dat,toy_data1-11,0,sample001,de17c7b3f0ff5126831c2d519f481055ba466ddb62386661323xxxxx
å®Ÿé¨“2,data001.dat,toy_data1-12,1,sample002,de17c7b3f0ff5126831c2d519f481055ba466ddb62386661323xxxxx
å®Ÿé¨“3,data002.dat,toy_data1-13,2,sample003,de17c7b3f0ff5126831c2d519f481055ba466ddb62386661323xxxxx
```

- 3ã‹ã‚‰5è¡Œç›®ãŒã€3ã¤ã®å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’3ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ç™»éŒ²ã™ã‚‹ãŸã‚ã«è¨˜å…¥ã•ã‚ŒãŸã‚‚ã®ã§ã™
- 1è¡Œç›®ã¯ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã§ã™
- 2è¡Œç›®ã¯è¨˜å…¥ã—ãŸåˆ—ã®å€¤ãŒã€é€çŠ¶é …ç›®ã®ã©ã‚Œã¨é–¢é€£(ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ”ãƒ³ã‚°)ã¥ã‘ã‚‹ã‹ç¤ºã—ã¦ã„ã¾ã™
- å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¯inpudata1ã®åˆ—ã«è¨˜è¼‰ã—ã¾ã™
- ã“ã®å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¯è¤‡æ•°åˆ—æŒ‡å®šã§ãã€inputdata1ã€inputdata2ã¨ã„ã†ã‚ˆã†ã«2è¡Œç›®ã«è¨˜è¼‰ã—ã¾ã™

ãã‚Œã§ã¯å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ã¾ãšã¯å®Ÿè¡Œå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã®ç¢ºèª
```
container $ tree data
data
â”œâ”€â”€ inputdata
â”‚   â”œâ”€â”€ data.zip
â”‚   â””â”€â”€ smarttable_test.csv
â”œâ”€â”€ invoice
â”‚   â””â”€â”€ invoice.json
â””â”€â”€ tasksupport
    â”œâ”€â”€ invoice.schema.json
    â””â”€â”€ metadata-def.json

4 directories, 5 files
```

å®Ÿè¡Œä¸­
```
container $ python main.py                                
(PosixPath('data/temp/fsmarttable_test_0000.csv'), PosixPath('data/temp/data000.dat'))
(PosixPath('data/temp/fsmarttable_test_0001.csv'), PosixPath('data/temp/data001.dat'))
(PosixPath('data/temp/fsmarttable_test_0002.csv'), PosixPath('data/temp/data002.dat'))
container $
```

### å®Ÿè¡Œå¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã‚’ã¿ãªãŒã‚‰RDEToolKitã®ãƒ¢ãƒ¼ãƒ‰ã®å½¹å‰²ã«ã¤ã„ã¦èª¬æ˜

SmartTableInvoiceãƒ¢ãƒ¼ãƒ‰ã®è¦ç‚¹
- 3ã¤ã®å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãŒã€dataç›´ä¸‹(ï¼‘ä»¶ç›®)ã¨dividedä»¥ä¸‹(2ä»¶ç›®ä»¥é™)ã«åˆ†ã‹ã‚Œã¦é…ç½®ã•ã‚Œã‚‹
- ãã‚Œãã‚Œã®invoice.jsonãŒsmarttable_test.csvã§ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚ŒãŸå€¤ã«ç½®ãæ›ã‚ã£ã¦ã„ã‚‹
- ä»¥ä¸ŠãŒSmartTableInvoiceãƒ¢ãƒ¼ãƒ‰ã®å½¹å‰²ã§ã™
- datasets_process.pyã®dataseté–¢æ•°ã®å‡¦ç†ãŒãƒ‡ãƒ¼ã‚¿æ•°åˆ†ç¹°ã‚Šè¿”ã•ã‚Œã¦ã„ã‚‹
  - dataseté–¢æ•°ãŒ3å›å®Ÿè¡Œ
  - ã¤ã¾ã‚Šã€datasetmé–¢æ•°ã«æ›¸ã„ãŸå‡¦ç†ãŒãƒ‡ãƒ¼ã‚¿æ•°åˆ†ç¹°ã‚Šè¿”ã•ã‚Œã¾ã™
  - ã“ã‚Œã¯RDEToolKitãŒãƒ‡ãƒ¼ã‚¿æ•°åˆ†ç¹°ã‚Šè¿”ã™ã‚ˆã†ã«ä½œã‚‰ã‚Œã¦ã„ã‚‹ã‹ã‚‰ã§ã™

å®Ÿè¡Œå¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
```
container $ tree data
data
â”œâ”€â”€ attachment
â”œâ”€â”€ divided
â”‚   â”œâ”€â”€ 0001
â”‚   â”‚   â”œâ”€â”€ attachment
â”‚   â”‚   â”œâ”€â”€ invoice
â”‚   â”‚   â”‚   â””â”€â”€ invoice.json
â”‚   â”‚   â”œâ”€â”€ invoice_patch
â”‚   â”‚   â”œâ”€â”€ logs
â”‚   â”‚   â”œâ”€â”€ main_image
â”‚   â”‚   â”œâ”€â”€ meta
â”‚   â”‚   â”œâ”€â”€ nonshared_raw
â”‚   â”‚   â”‚   â””â”€â”€ data001.dat
â”‚   â”‚   â”œâ”€â”€ other_image
â”‚   â”‚   â”œâ”€â”€ raw
â”‚   â”‚   â”œâ”€â”€ structured
â”‚   â”‚   â”œâ”€â”€ temp
â”‚   â”‚   â””â”€â”€ thumbnail
â”‚   â””â”€â”€ 0002
â”‚       â”œâ”€â”€ attachment
â”‚       â”œâ”€â”€ invoice
â”‚       â”‚   â””â”€â”€ invoice.json
â”‚       â”œâ”€â”€ invoice_patch
â”‚       â”œâ”€â”€ logs
â”‚       â”œâ”€â”€ main_image
â”‚       â”œâ”€â”€ meta
â”‚       â”œâ”€â”€ nonshared_raw
â”‚       â”‚   â””â”€â”€ data002.dat
â”‚       â”œâ”€â”€ other_image
â”‚       â”œâ”€â”€ raw
â”‚       â”œâ”€â”€ structured
â”‚       â”œâ”€â”€ temp
â”‚       â””â”€â”€ thumbnail
â”œâ”€â”€ inputdata
â”‚   â”œâ”€â”€ data.zip
â”‚   â””â”€â”€ smarttable_test.csv
â”œâ”€â”€ invoice
â”‚   â””â”€â”€ invoice.json
â”œâ”€â”€ invoice_patch
â”œâ”€â”€ logs
â”‚   â””â”€â”€ rdesys.log
â”œâ”€â”€ main_image
â”œâ”€â”€ meta
â”œâ”€â”€ nonshared_raw
â”‚   â””â”€â”€ data000.dat
â”œâ”€â”€ other_image
â”œâ”€â”€ raw
â”œâ”€â”€ structured
â”œâ”€â”€ tasksupport
â”‚   â”œâ”€â”€ invoice.schema.json
â”‚   â””â”€â”€ metadata-def.json
â”œâ”€â”€ temp
â”‚   â”œâ”€â”€ data000.dat
â”‚   â”œâ”€â”€ data001.dat
â”‚   â”œâ”€â”€ data002.dat
â”‚   â”œâ”€â”€ fsmarttable_test_0000.csv
â”‚   â”œâ”€â”€ fsmarttable_test_0001.csv
â”‚   â””â”€â”€ fsmarttable_test_0002.csv
â””â”€â”€ thumbnail

42 directories, 17 files
container $ 
```


ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã«å…¥åŠ›ã—ãŸå†…å®¹ã¨invoice.jsonã®å†…å®¹ã‚’æ¯”è¼ƒã—ã¦ã¿ã¦ãã ã•ã„ã€‚

å®Ÿè¡Œå¾Œã®å„invoice.json

data/invoice/invoice.json
```json
{
    "datasetId": "3f976089-7b0b-4c66-a035-f48773b018e6",
    "basic": {
        "dateSubmitted": "",
        "dataOwnerId": "7e4792d1a8440bcfa08925d35e9d92b234a963449f03df44123xxxxx",
        "dataName": "å®Ÿé¨“1",
        "instrumentId": null,
        "experimentId": null,
        "description": null
    },
    "custom": {
        "toy_data1": "toy_data1-11",
        "toy_data2": 1.0,
        "sample2": 0
    },
    "sample": {
        "sampleId": "",
        "names": [
            "sample001"
        ],
        "composition": null,
        "referenceUrl": null,
        "description": null,
        "generalAttributes": [],
        "specificAttributes": [],
        "ownerId": "de17c7b3f0ff5126831c2d519f481055ba466ddb62386661323xxxxx"
    }
}```

data/divided/0001
```json
{
    "datasetId": "3f976089-7b0b-4c66-a035-f48773b018e6",
    "basic": {
        "dateSubmitted": "",
        "dataOwnerId": "7e4792d1a8440bcfa08925d35e9d92b234a963449f03df44123xxxxx",
        "dataName": "å®Ÿé¨“2",
        "instrumentId": null,
        "experimentId": null,
        "description": null
    },
    "custom": {
        "toy_data1": "toy_data1-12",
        "toy_data2": 1.0,
        "sample2": 1
    },
    "sample": {
        "sampleId": "",
        "names": [
            "sample002"
        ],
        "composition": null,
        "referenceUrl": null,
        "description": null,
        "generalAttributes": [],
        "specificAttributes": [],
        "ownerId": "de17c7b3f0ff5126831c2d519f481055ba466ddb62386661323xxxxx"
    }
}```

data/divided/00002
```json
{
    "datasetId": "3f976089-7b0b-4c66-a035-f48773b018e6",
    "basic": {
        "dateSubmitted": "",
        "dataOwnerId": "7e4792d1a8440bcfa08925d35e9d92b234a963449f03df44123xxxxx",
        "dataName": "å®Ÿé¨“3",
        "instrumentId": null,
        "experimentId": null,
        "description": null
    },
    "custom": {
        "toy_data1": "toy_data1-13",
        "toy_data2": 1.0,
        "sample2": 2
    },
    "sample": {
        "sampleId": "",
        "names": [
            "sample003"
        ],
        "composition": null,
        "referenceUrl": null,
        "description": null,
        "generalAttributes": [],
        "specificAttributes": [],
        "ownerId": "de17c7b3f0ff5126831c2d519f481055ba466ddb62386661323xxxxx"
    }
}
```

### ãƒ•ã‚©ãƒ«ãƒ€ã‚ã‚Šãªã©ã®äº‹ä¾‹

#### ãƒ•ã‚©ãƒ«ãƒ€ã«å«ã¾ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ãŸã„

ã‚µãƒ³ãƒ—ãƒ«ã®å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `mode_smarttableinvoice/input/with_folder`ã‚’å‚ç…§ã€‚

- å…¥åŠ›ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ‡ãƒ¼ã‚¿å˜ä½ã”ã¨ã«åŒåã§ã‚ã‚‹å ´åˆãªã©ãƒ•ã‚©ãƒ«ãƒ€ä»˜ãã§ä½¿ã„ãŸã„å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™
- å®Ÿé¨“çµæœã‚’ãƒ•ã‚©ãƒ«ãƒ€ã§ç®¡ç†ã—ã¦ã„ã‚‹å ´åˆã¯ã“ã®æ–¹æ³•ã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãŒã§ãã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹

ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

- å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãŒå„ãƒ‡ãƒ¼ã‚¿ã§æœ€å¤§2ã¤ã®ãŸã‚ã€inputdataåˆ—ã‚’ã€inputdata1,inputdata2ã®äºŒã¤ç”¨æ„ã—ã¾ã—ãŸ
- ãƒ•ã‚©ãƒ«ãƒ€ä»˜ãã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¾ã™

```
# for smarttableinvoice mode
basic/dataName,inputdata1,inputdata2,custom/toy_data1,custom/sample2,sample/names,sample/ownerId
å®Ÿé¨“1,data000/data.dat,data000/report.txt,toy_data1-11,0,sample001,de17c7b3f0ff5126831c2d519f481055ba466ddb62386661323xxxxx
å®Ÿé¨“2,data001/data.dat,data001/report.txt,toy_data1-12,1,sample002,de17c7b3f0ff5126831c2d519f481055ba466ddb62386661323xxxxx
å®Ÿé¨“3,data002/data.dat,data002/report.txt,toy_data1-13,2,sample003,de17c7b3f0ff5126831c2d519f481055ba466ddb62386661323xxxxx
```


å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã¾ã¨ã‚ã¾ã™

**å…¥åŠ›ã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä¸€ã¤ãšã¤ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã—ãŸå ´åˆ**

```
container $ zip -r data.zip data000 data001 data002
  adding: data000/ (stored 0%)
  adding: data000/data.dat (stored 0%)
  adding: data000/report.dat (stored 0%)
  adding: data001/ (stored 0%)
  adding: data001/data.dat (stored 0%)
  adding: data001/report.txt (stored 0%)
  adding: data002/ (stored 0%)
  adding: data002/data.dat (stored 0%)
  adding: data002/report.txt (stored 0%)
```
ã¾ãŸã¯æ¬¡ã®ã‚ˆã†ãªã¾ã¨ã‚æ–¹ã§ã‚‚ç™»éŒ²ã§ãã¾ã™ã€‚<br>

**å…¥åŠ›ã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ãŒå«ã¾ã‚Œã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã—ãŸå ´åˆ**

```
container $ zip -r data.zip with_folders
  adding: with_folders/ (stored 0%)
  adding: with_folders/data002/ (stored 0%)
  adding: with_folders/data002/report.txt (stored 0%)
  adding: with_folders/data002/data.dat (stored 0%)
  adding: with_folders/data001/ (stored 0%)
  adding: with_folders/data001/report.txt (stored 0%)
  adding: with_folders/data001/data.dat (stored 0%)
  adding: with_folders/data000/ (stored 0%)
  adding: with_folders/data000/report.txt (stored 0%)
  adding: with_folders/data000/data.dat (stored 0%)
```

å®Ÿè¡Œå¾Œ

nonshared_rawã«data.datã€report.txtãŒé…ç½®ã•ã‚Œã¦ã„ã¾ã™ã€‚
```
container $ tree data
data
â”œâ”€â”€ attachment
â”œâ”€â”€ divided
â”‚   â”œâ”€â”€ 0001
â”‚   â”‚   â”œâ”€â”€ attachment
â”‚   â”‚   â”œâ”€â”€ invoice
â”‚   â”‚   â”‚   â””â”€â”€ invoice.json
â”‚   â”‚   â”œâ”€â”€ invoice_patch
â”‚   â”‚   â”œâ”€â”€ logs
â”‚   â”‚   â”œâ”€â”€ main_image
â”‚   â”‚   â”œâ”€â”€ meta
â”‚   â”‚   â”œâ”€â”€ nonshared_raw
â”‚   â”‚   â”‚   â”œâ”€â”€ data.dat
â”‚   â”‚   â”‚   â””â”€â”€ report.txt
â”‚   â”‚   â”œâ”€â”€ other_image
â”‚   â”‚   â”œâ”€â”€ raw
â”‚   â”‚   â”œâ”€â”€ structured
â”‚   â”‚   â”œâ”€â”€ temp
â”‚   â”‚   â””â”€â”€ thumbnail
çœç•¥
```

#### 1ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å„ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ã«å‰²ã‚Šå½“ã¦ãŸã„

ã‚µãƒ³ãƒ—ãƒ«ã®å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `mode_smarttableinvoice/input/common_file`ã‚’å‚ç…§ã€‚


ï¼‘ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ã™ã¹ã¦ã«å‰²ã‚Šå½“ã¦ã‚‹å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿(*.dat)ãŒã‚ã‚Šã€ãã‚Œã‚‰ã«å…±é€šã™ã‚‹commo.txtã‚’ãƒ‡ãƒ¼ã‚¿ã”ã¨ã«ç™»éŒ²ã™ã‚‹å ´åˆã‚’æƒ³å®šã—ã¦ã¿ã¾ã™ã€‚

```cmd
$ tree data2
data2
â”œâ”€â”€ common
â”‚   â””â”€â”€ common.txt
â”œâ”€â”€ data001.dat (ç™»éŒ²æ™‚ã«common.txtã‚‚è¿½åŠ ã—ãŸã„)
â”œâ”€â”€ data002.dat (ç™»éŒ²æ™‚ã«common.txtã‚‚è¿½åŠ ã—ãŸã„)
â””â”€â”€ data003.dat (ç™»éŒ²æ™‚ã«common.txtã‚‚è¿½åŠ ã—ãŸã„)
```

ä»¥ä¸‹ã®ã‚ˆã†ãªzipãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸã€‚
```
container $ zip -r data.zip ./data2    
  adding: data2/ (stored 0%)
  adding: data2/data001.dat (stored 0%)
  adding: data2/common/ (stored 0%)
  adding: data2/common/common.txt (stored 0%)
  adding: data2/data002.dat (stored 0%)
  adding: data2/data003.dat (stored 0%)
```


ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã—ã¾ã™ã€‚
- inputdata1ã«ãƒ‡ãƒ¼ã‚¿ã”ã¨ã«ç•°ãªã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™
- inputdata2ã«å…±é€šã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™
- å…±é€šã—ã¦ä½¿ã†ãƒ•ã‚¡ã‚¤ãƒ«common.txtã¯commonãƒ•ã‚©ãƒ«ãƒ€ã«ç½®ã‹ã‚Œã¦ã„ã‚‹ãŸã‚common/common.txtã¨æŒ‡å®šã—ã¦ã„ã¾ã™

```
# for smarttableinvoice mode
basic/dataName,inputdata1,inputdata2,custom/toy_data1,custom/sample2,sample/names,sample/ownerId
å®Ÿé¨“1,data000.dat,common/common.txt,toy_data1-11,0,sample001,de17c7b3f0ff5126831c2d519f481055ba466ddb62386661323xxxxx
å®Ÿé¨“2,data001.dat,common/common.txt,toy_data1-12,1,sample002,de17c7b3f0ff5126831c2d519f481055ba466ddb62386661323xxxxx
å®Ÿé¨“3,data002.dat,common/common.txt,toy_data1-13,2,sample003,de17c7b3f0ff5126831c2d519f481055ba466ddb62386661323xxxxx
```

## MultiDataTile mode

![data flow in MultiDataTile mode](docs/images/multidatatile_mode_dataflow.png "data flow in MultiDataTile mode")

å‚ç…§: [RDEToolKit Documentation MultiDataTileãƒ¢ãƒ¼ãƒ‰ã¨ã¯](https://nims-mdpf.github.io/rdetoolkit/usage/mode/mode_multidatatile/)

- `MultiDataTile mode`(ãƒãƒ«ãƒãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒˆãƒ«)ã¯ã€ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ã¨åŒæ§˜ã«ï¼‘å›ã«è¤‡æ•°ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã§ãã‚‹ãƒ¢ãƒ¼ãƒ‰ã§ã™
- ãŸã ã—ã€é€çŠ¶ã®å†…å®¹ã¯åŒä¸€ã¨ãªã‚Šã¾ã™
- `1ç™»éŒ²ã§è¤‡æ•°ãƒ‡ãƒ¼ã‚¿`ã€ãƒ‡ãƒ¼ã‚¿ã”ã¨ã«`é€çŠ¶ã®å†…å®¹ã‚’å¤‰ãˆã‚‰ã‚Œã¾ã›ã‚“`
- magic_variableã‚’ä½¿ã†ã¨ãƒ‡ãƒ¼ã‚¿åã‚’ãƒ•ã‚¡ã‚¤ãƒ«åã«ã™ã‚‹ãªã©ã®æ“ä½œãŒã§ãã¾ã™
- æä¾›ã—ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã€DatasetTemplates/mode_multidatatileã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä½¿ã£ã¦ãã ã•ã„
- ã“ã“ã§ã¯RDEToolKitã‚’ä½¿ã£ã¦åˆæœŸåŒ–ã™ã‚‹ã¨ã“ã‚ã‹ã‚‰é †ã‚’è¿½ã£ã¦èª¬æ˜ã—ã¦ã„ã¾ã™(åˆã‚ã‹ã‚‰ä½œã£ã¦ã¿ãŸã„äººã¯æ˜¯éã«)
- æœ€çµ‚çš„ã«ã§ãã‚ãŒã‚‹ã‚‚ã®ã¯ DatasetTemplates/mode_multidatatile ã¨åŒã˜å†…å®¹ã§ã™
- ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ã®ã‚µãƒ³ãƒ—ãƒ«ã¯mode_multidatatile/input/inputdataã«ã‚ã‚Šã¾ã™
- docker containerã‚’ä½¿ã£ã¦å®Ÿè¡Œã—ãŸã„æ–¹ã¯mode_multidatatileã®readme.mdã‚’å‚ç…§ã—ã¦ãã ã•ã„

### æº–å‚™

æ–°ãŸã«ãƒãƒ«ãƒãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ«ç”¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—é››å½¢ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™

```cmd
$ mkdir mode_multidatatile
$ cd  mode_multidatatile
mode_multidatatile $ python -m rdetoolkit init
mode_multidatatile $ cd container
container $
```

ã•ã‚‰ã«ã€main.pyã¨datasets_process.pyã‚’Invoice modeã¨åŒã˜å†…å®¹ã§ãã‚Œãã‚Œæ‰€å®šã®ãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®ã—ã¾ã™ã€‚

```cmd
(venv) mode_multidatatile $ python -m rdetoolkit init
```

å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æº–å‚™ã—ã¾ã™ã€‚
data000.datã€data001.datã€data002.datã‚’ãã‚Œãã‚Œãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ç™»éŒ²ã—ã¾ã™ã€‚1å›ã®ç™»éŒ²ã§ã“ã‚Œã‚‰3ãƒ•ã‚¡ã‚¤ãƒ«ãŒ3ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ç™»éŒ²ã•ã‚Œã¾ã™ã€‚
```cmd
container $ touch data/inputdata/data000.dat
container $ touch data/inputdata/data001.dat
container $ touch data/inputdata/data002.dat
```


tasksupportã«ä»¥ä¸‹ã®å†…å®¹ã®rdeconfig.yamlã‚’é…ç½®

ãƒãƒ«ãƒãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ«ãƒ¢ãƒ¼ãƒ‰ã«ã™ã‚‹ã«ã¯ã“ã®è¨­å®šã¯é‡è¦ã§ã™ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã“ã®è¨­å®šã®çŠ¶æ…‹ã§é…ç½®ã—ãªã„å ´åˆã¯ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã¨ãªã‚Šã¾ã™ã€‚

```text
system:
  extended_mode: MultiDataTile
```

å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ã¾ãšã¯å®Ÿè¡Œå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã®ç¢ºèª

```
container $ tree data
data
â”œâ”€â”€ inputdata
â”‚   â”œâ”€â”€ data000.dat
â”‚   â”œâ”€â”€ data001.dat
â”‚   â””â”€â”€ data002.dat
â”œâ”€â”€ invoice
â”‚   â””â”€â”€ invoice.json
â””â”€â”€ tasksupport
    â”œâ”€â”€ invoice.schema.json
    â”œâ”€â”€ metadata-def.json
    â””â”€â”€ rdeconfig.yaml
4 directories, 7 files
```

å®Ÿè¡Œä¸­
```
container $ python main.py
(PosixPath('data/inputdata/data000.dat'),)
(PosixPath('data/inputdata/data001.dat'),)
(PosixPath('data/inputdata/data002.dat'),)
container $
```


å®Ÿè¡Œå¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«éšå±¤
```
container $ tree data
data
â”œâ”€â”€ attachment
â”œâ”€â”€ divided
â”‚   â”œâ”€â”€ 0001
â”‚   â”‚   â”œâ”€â”€ attachment
â”‚   â”‚   â”œâ”€â”€ invoice
â”‚   â”‚   â”‚   â””â”€â”€ invoice.json
â”‚   â”‚   â”œâ”€â”€ invoice_patch
â”‚   â”‚   â”œâ”€â”€ logs
â”‚   â”‚   â”œâ”€â”€ main_image
â”‚   â”‚   â”œâ”€â”€ meta
â”‚   â”‚   â”œâ”€â”€ nonshared_raw
â”‚   â”‚   â”‚   â””â”€â”€ data001.dat
â”‚   â”‚   â”œâ”€â”€ other_image
â”‚   â”‚   â”œâ”€â”€ raw
â”‚   â”‚   â”œâ”€â”€ structured
â”‚   â”‚   â”œâ”€â”€ temp
â”‚   â”‚   â””â”€â”€ thumbnail
â”‚   â””â”€â”€ 0002
â”‚       â”œâ”€â”€ attachment
â”‚       â”œâ”€â”€ invoice
â”‚       â”‚   â””â”€â”€ invoice.json
â”‚       â”œâ”€â”€ invoice_patch
â”‚       â”œâ”€â”€ logs
â”‚       â”œâ”€â”€ main_image
â”‚       â”œâ”€â”€ meta
â”‚       â”œâ”€â”€ nonshared_raw
â”‚       â”‚   â””â”€â”€ data002.dat
â”‚       â”œâ”€â”€ other_image
â”‚       â”œâ”€â”€ raw
â”‚       â”œâ”€â”€ structured
â”‚       â”œâ”€â”€ temp
â”‚       â””â”€â”€ thumbnail
â”œâ”€â”€ inputdata
â”‚   â”œâ”€â”€ data000.dat
â”‚   â”œâ”€â”€ data001.dat
â”‚   â””â”€â”€ data002.dat
â”œâ”€â”€ invoice
â”‚   â””â”€â”€ invoice.json
â”œâ”€â”€ invoice_patch
â”œâ”€â”€ logs
â”œâ”€â”€ main_image
â”œâ”€â”€ meta
â”œâ”€â”€ nonshared_raw
â”‚   â””â”€â”€ data000.dat
â”œâ”€â”€ other_image
â”œâ”€â”€ raw
â”œâ”€â”€ structured
â”œâ”€â”€ tasksupport
â”‚   â”œâ”€â”€ invoice.schema.json
â”‚   â”œâ”€â”€ metadata-def.json
â”‚   â””â”€â”€ rdeconfig.yaml
â”œâ”€â”€ temp
â”‚   â””â”€â”€ invoice_org.json
â””â”€â”€ thumbnail

42 directories, 14 files
(venv) container $ 
```

### å®Ÿè¡Œå¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã‚’ã¿ãªãŒã‚‰RDEToolKitã®ãƒ¢ãƒ¼ãƒ‰ã®å½¹å‰²ã«ã¤ã„ã¦èª¬æ˜

ã‚¤ãƒ³ãƒœã‚¤ã‚¹ã‚¨ã‚¯ã‚»ãƒ«ãƒ¢ãƒ¼ãƒ‰ã®ã¨ãã®ãƒ•ã‚¡ã‚¤ãƒ«é…ç½®ã¨åŒã˜ã«ãªã£ã¦ã„ã¾ã™ãŒã€ä»¥ä¸‹ã®é•ã„ãŒã‚ã‚Šã¾ã™ã€‚
- ãƒãƒ«ãƒãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ«ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã€å„ãƒ‡ãƒ¼ã‚¿ã®invoice.jsonã¯åŒä¸€ã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿åã‚‚æœ€åˆã®invoice.jsonã®å…¥åŠ›å†…å®¹ãŒã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã™
- ãã®ãŸã‚ã€å„ãƒ‡ãƒ¼ã‚¿å(invoice.jsonã®basic.dataName)ã¯å®Ÿè¡Œæ™‚ã®invoice.jsonã§æŒ‡å®šã—ãŸãƒ‡ãƒ¼ã‚¿åã¨ã™ã¹ã¦åŒä¸€ã§ã™
    ```json
    {
        "datasetId": "3f976089-7b0b-4c66-a035-f48773b018e6",
        "basic": {
            "dateSubmitted": "",
            "dataOwnerId": "7e4792d1a8440bcfa08925d35e9d92b234a963449f03df441234569e",
            "dataName": "toy dataset",
            "instrumentId": null,
            "experimentId": null,
            "description": null
        }
    }
    ```
- ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ã§ã¯ã€å„ãƒ‡ãƒ¼ã‚¿ã®invoice.jsonã®å†…å®¹ã‚’ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ã®å†…å®¹ã§ä¸Šæ›¸ãã•ã‚Œã¾ã™


ãŸã ã—ã€rdeconfig.yamlã§magic_variableã‚’æœ‰åŠ¹ã«ã—ã¦ã€invoice.jsonã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ã™ã‚‹ã¨ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ãƒ‡ãƒ¼ã‚¿åã«å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

å…¥åŠ›æ™‚ã®invoice/invoice.jsonã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ basic.dataNameã‚’`${filename}`ã¨ã™ã‚‹ã€‚
```json
{
    "datasetId": "3f976089-7b0b-4c66-a035-f48773b018e6",
    "basic": {
        "dateSubmitted": "",
        "dataOwnerId": "7e4792d1a8440bcfa08925d35e9d92b234a963449f03df441234569e",
        "dataName": "${filename}",
        "instrumentId": null,
        "experimentId": null,
        "description": null
    }
}
```

ã¾ãŸã€tasksuppor/rdeconfig.yamlã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚
```
system:
  extended_mode: MultiDataTile
  magic_variable: true
```

ã“ã‚Œã§å†åº¦å®Ÿè¡Œã—ã¦invoice.jsonã‚’ã¿ã¦ã¿ã¾ã™ã€‚

divided/0002/invoice/invoice.jsonã®å†…å®¹

dataNameãŒã€data002.datã¨ãªã£ã¦ã„ã¾ã™ã€‚

```
{
    "datasetId": "3f976089-7b0b-4c66-a035-f48773b018e6",
    "basic": {
        "dateSubmitted": "",
        "dataOwnerId": "7e4792d1a8440bcfa08925d35e9d92b234a963449f03df441234569e",
        "dataName": "data002.dat",
        "instrumentId": null,
        "experimentId": null,
        "description": null
    }
}
```

## RDEFormat mode

å‚ç…§: [RDEToolKit Documentation RDEFormatãƒ¢ãƒ¼ãƒ‰ã¨ã¯](https://nims-mdpf.github.io/rdetoolkit/usage/mode/mode_rdeformat/)

- `rdeformat`ã¯äºˆã‚ãƒ­ãƒ¼ã‚«ãƒ«PCãªã©ã§æ§‹é€ åŒ–å‡¦ç†ã‚’è¡Œã£ãŸçµæœã‚’rdeformatå½¢å¼ã§ãƒ•ã‚¡ã‚¤ãƒ«é…ç½®ã—ãŸã‚‚ã®ã‚’zipå½¢å¼ã«ã—ã¦ç™»éŒ²ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™
- ã“ã“ã§ã¯mode_multidatatileã®æ§‹é€ åŒ–å‡¦ç†ã§å¾—ã‚‰ã‚ŒãŸå‡ºåŠ›çµæœã‚’RDEFormat modeã§ç™»éŒ²ã™ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¾ã™
- æä¾›ã—ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã€DatasetTemplates/mode_rdeformatã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä½¿ã£ã¦ãã ã•ã„
- ã“ã“ã§ã¯RDEToolKitã‚’ä½¿ã£ã¦åˆæœŸåŒ–ã™ã‚‹ã¨ã“ã‚ã‹ã‚‰é †ã‚’è¿½ã£ã¦èª¬æ˜ã—ã¦ã„ã¾ã™(åˆã‚ã‹ã‚‰ä½œã£ã¦ã¿ãŸã„äººã¯æ˜¯éã«)
- æœ€çµ‚çš„ã«ã§ãã‚ãŒã‚‹ã‚‚ã®ã¯ DatasetTemplates/mode_rdeformat ã¨åŒã˜å†…å®¹ã§ã™
- ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ã®ã‚µãƒ³ãƒ—ãƒ«ã¯mode_rdeformat/input/inputdataã«ã‚ã‚Šã¾ã™
- docker containerã‚’ä½¿ã£ã¦å®Ÿè¡Œã—ãŸã„æ–¹ã¯mode_rdeformatã®readme.mdã‚’å‚ç…§ã—ã¦ãã ã•ã„

**ç•™æ„ç‚¹**
- `rdeformat`ãƒ¢ãƒ¼ãƒ‰ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«é…ç½®ã§ã¯invoice.jsonã¯ã‚·ã‚¹ãƒ†ãƒ ãŒä½œæˆã—ãŸã‚‚ã®ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã™
- ãã®ãŸã‚ã€invoice.jsonã‚’æŠ•å…¥ã™ã‚‹zipãƒ•ã‚¡ã‚¤ãƒ«ã«å«ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“
- ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã§ã¯å…¨éƒ¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒä¸è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å‰Šé™¤ã—ãŸã‚‚ã®ã‚’ç”¨æ„ã—ã¾ã—ãŸ
- ã‚ã‚‰ã‹ã˜ã‚ç”¨æ„ã—ãŸinvoice.jsonã¯temp/invoice.json.orgã«ä¿å­˜ã•ã‚Œã¾ã™
- invoice.jsonã®å†…å®¹ã‚’æ§‹é€ åŒ–å‡¦ç†ã§æ›¸ãç›´ã™ã“ã¨ã§ã‚·ã‚¹ãƒ†ãƒ ç™»éŒ²æ™‚ã«ãã®å†…å®¹ã‚’åæ˜ ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™
- ãŸã ã—IDã‚’æ›¸ãç›´ã™å ´åˆã¯å®Ÿéš›ã«å­˜åœ¨ã™ã‚‹IDã‚’æ­£ã—ãå…¥åŠ›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

### æº–å‚™
```cmd
$ mkdir mode_rdeformat
$ cd  mode_rdeformat
mode_rdeformat $ python -m rdetoolkit init
mode_rdeformat $ cd container
container $
```

ã•ã‚‰ã«ã€main.pyã¨datasets_process.pyã‚’Invoice modeã¨åŒã˜å†…å®¹ã§ãã‚Œãã‚Œæ‰€å®šã®ãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®ã—ã¾ã™ã€‚

tasksupport/rdeconfig.yamlã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚
```yaml
system:
  extended_mode: rdeformat
```

### ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™
- mode_multidatatileãªã©ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã—ãŸå¾Œã®container/dataä»¥ä¸‹ã‚’zipå½¢å¼ã§ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã—ã¾ã™
- ãŸã ã—ã€logsã€tempã€tasksupportã¯å–ã‚Šé™¤ã„ã¦ãã ã•ã„
- ä¸‹è¨˜ã®ä¾‹ã§ã¯zipæ™‚ã«ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–ã‚Šé™¤ã„ã¦ã„ã¾ã™

zipåœ§ç¸®ã®äº‹ä¾‹ã§ã™ã€‚
```cmd
$ zip -r data.zip data -x \*/logs/\* \*/temp/\* \*/tasksupport/\*
  adding: data/ (stored 0%)
  adding: data/thumbnail/ (stored 0%)
  adding: data/divided/ (stored 0%)
  adding: data/divided/0002/ (stored 0%)
  adding: data/divided/0002/thumbnail/ (stored 0%)
  adding: data/divided/0002/attachment/ (stored 0%)
  adding: data/divided/0002/meta/ (stored 0%)
  adding: data/divided/0002/nonshared_raw/ (stored 0%)
  adding: data/divided/0002/nonshared_raw/data002.dat (stored 0%)
  adding: data/divided/0002/structured/ (stored 0%)
  adding: data/divided/0002/invoice_patch/ (stored 0%)
  adding: data/divided/0002/main_image/ (stored 0%)
  adding: data/divided/0002/other_image/ (stored 0%)
  adding: data/divided/0002/raw/ (stored 0%)
  adding: data/divided/0002/invoice/ (stored 0%)
  adding: data/divided/0002/invoice/invoice.json (deflated 56%)
  adding: data/divided/0001/ (stored 0%)
  adding: data/divided/0001/thumbnail/ (stored 0%)
  adding: data/divided/0001/attachment/ (stored 0%)
  adding: data/divided/0001/meta/ (stored 0%)
  adding: data/divided/0001/nonshared_raw/ (stored 0%)
  adding: data/divided/0001/nonshared_raw/data001.dat (stored 0%)
  adding: data/divided/0001/structured/ (stored 0%)
  adding: data/divided/0001/invoice_patch/ (stored 0%)
  adding: data/divided/0001/main_image/ (stored 0%)
  adding: data/divided/0001/other_image/ (stored 0%)
  adding: data/divided/0001/raw/ (stored 0%)
  adding: data/divided/0001/invoice/ (stored 0%)
  adding: data/divided/0001/invoice/invoice.json (deflated 56%)
  adding: data/inputdata/ (stored 0%)
  adding: data/inputdata/data001.dat (stored 0%)
  adding: data/inputdata/data000.dat (stored 0%)
  adding: data/inputdata/data002.dat (stored 0%)
  adding: data/attachment/ (stored 0%)
  adding: data/meta/ (stored 0%)
  adding: data/nonshared_raw/ (stored 0%)
  adding: data/nonshared_raw/data000.dat (stored 0%)
  adding: data/structured/ (stored 0%)
  adding: data/invoice_patch/ (stored 0%)
  adding: data/main_image/ (stored 0%)
  adding: data/other_image/ (stored 0%)
  adding: data/raw/ (stored 0%)
  adding: data/invoice/ (stored 0%)
  adding: data/invoice/invoice.json (deflated 56%)
```
ã§ããŸdata.zipãƒ•ã‚¡ã‚¤ãƒ«ã‚’inputdataã®ä¸‹ã«é…ç½®ã—ã¾ã™ã€‚

ãã‚Œã§ã¯å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ã¾ãšã¯å®Ÿè¡Œå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã®ç¢ºèª
```cmd
container $ tree data
data
â”œâ”€â”€ inputdata
â”‚   â””â”€â”€ data.zip
â”œâ”€â”€ invoice
â”‚   â””â”€â”€ invoice.json
â””â”€â”€ tasksupport
    â”œâ”€â”€ invoice.schema.json
    â”œâ”€â”€ metadata-def.json
    â””â”€â”€ rdeconfig.yaml

4 directories, 5 files
```

å®Ÿè¡Œä¸­ã€€ãƒ•ã‚¡ã‚¤ãƒ«ã®å±•é–‹å…ˆãŒä¸‹è¨˜ã®ã‚ˆã†ã«3å›å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯zipãƒ•ã‚¡ã‚¤ãƒ«ã‚’å±•é–‹ã—ãŸå†…å®¹ã‚’å…ƒã«å‡ºåŠ›ã•ã‚ŒãŸã‚‚ã®ã§ã™ã€‚ä»–ã®ãƒ¢ãƒ¼ãƒ‰ã¨ã¯å‡ºåŠ›ãŒç•°ãªã‚Šã¾ã™ã€‚

rdeformatãƒ¢ãƒ¼ãƒ‰ã¯æ§‹é€ åŒ–å‡¦ç†æ¸ˆã¿ã®ãƒ•ã‚¡ã‚¤ãƒ«ä¸€å¼ã‚’ãã®ã¾ã¾æŠ•å…¥ã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ç”¨æ„ã•ã‚ŒãŸãŸã‚ã€ãƒ•ã‚¡ã‚¤ãƒ«å±•é–‹å¾Œã®æ§‹é€ åŒ–å‡¦ç†ã‚’æƒ³å®šã—ãŸã‚‚ã®ã¨ã¯ãªã£ã¦ã„ã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€resource_paths.rawfilesã®ãƒ‘ã‚¹ãŒä»–ã®ãƒ¢ãƒ¼ãƒ‰ã¨ç•°ãªã‚Šdata/tempã®ä¸‹ã«ãªã‚Šã¾ã™ã€‚rdeformatãƒ¢ãƒ¼ãƒ‰ã§ãƒ•ã‚¡ã‚¤ãƒ«å±•é–‹å¾Œã«æ§‹é€ åŒ–å‡¦ç†ã‚’ã™ã‚‹å ´åˆã¯ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿å…ˆãŒç•°ãªã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

```cmd
container $ python main.py
(PosixPath('data/temp/data/inputdata/data001.dat'), PosixPath('data/temp/data/inputdata/data000.dat'), PosixPath('data/temp/data/inputdata/data002.dat'), PosixPath('data/temp/data/nonshared_raw/data000.dat'), PosixPath('data/temp/data/invoice/invoice.json'))
(PosixPath('data/temp/data/divided/0001/nonshared_raw/data001.dat'), PosixPath('data/temp/data/divided/0001/invoice/invoice.json'))
(PosixPath('data/temp/data/divided/0002/nonshared_raw/data002.dat'), PosixPath('data/temp/data/divided/0002/invoice/invoice.json'))
container $
```

å®Ÿè¡Œå¾Œã€€ä»¥ä¸‹ã®ã‚ˆã†ã«RDEformatå½¢å¼ã§ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã—ãŸzipãƒ•ã‚¡ã‚¤ãƒ«ãŒå±•é–‹ã•ã‚Œã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«éšå±¤ã®é€šã‚Šã«é…ç½®ã•ã‚Œã¾ã™ã€‚
```
(venv) container $ tree data
data
â”œâ”€â”€ attachment
â”œâ”€â”€ divided
â”‚   â”œâ”€â”€ 0001
â”‚   â”‚   â”œâ”€â”€ attachment
â”‚   â”‚   â”œâ”€â”€ invoice
â”‚   â”‚   â”‚   â””â”€â”€ invoice.json
â”‚   â”‚   â”œâ”€â”€ invoice_patch
â”‚   â”‚   â”œâ”€â”€ logs
â”‚   â”‚   â”œâ”€â”€ main_image
â”‚   â”‚   â”œâ”€â”€ meta
â”‚   â”‚   â”œâ”€â”€ nonshared_raw
â”‚   â”‚   â”‚   â””â”€â”€ data001.dat
â”‚   â”‚   â”œâ”€â”€ other_image
â”‚   â”‚   â”œâ”€â”€ raw
â”‚   â”‚   â”œâ”€â”€ structured
â”‚   â”‚   â”œâ”€â”€ temp
â”‚   â”‚   â””â”€â”€ thumbnail
â”‚   â””â”€â”€ 0002
â”‚       â”œâ”€â”€ attachment
â”‚       â”œâ”€â”€ invoice
â”‚       â”‚   â””â”€â”€ invoice.json
â”‚       â”œâ”€â”€ invoice_patch
â”‚       â”œâ”€â”€ logs
â”‚       â”œâ”€â”€ main_image
â”‚       â”œâ”€â”€ meta
â”‚       â”œâ”€â”€ nonshared_raw
â”‚       â”‚   â””â”€â”€ data002.dat
â”‚       â”œâ”€â”€ other_image
â”‚       â”œâ”€â”€ raw
â”‚       â”œâ”€â”€ structured
â”‚       â”œâ”€â”€ temp
â”‚       â””â”€â”€ thumbnail
â”œâ”€â”€ inputdata
â”‚   â””â”€â”€ data_mode_rdeformat.zip
â”œâ”€â”€ invoice
â”‚   â””â”€â”€ invoice.json
â”œâ”€â”€ invoice_patch
â”œâ”€â”€ logs
â”‚   â””â”€â”€ rdesys.log
â”œâ”€â”€ main_image
â”œâ”€â”€ meta
â”œâ”€â”€ nonshared_raw
â”‚   â””â”€â”€ data000.dat
â”œâ”€â”€ other_image
â”œâ”€â”€ raw
â”œâ”€â”€ structured
â”œâ”€â”€ tasksupport
â”‚   â”œâ”€â”€ invoice.schema.json
â”‚   â”œâ”€â”€ metadata-def.json
â”‚   â””â”€â”€ rdeconfig.yaml
â”œâ”€â”€ temp
â”‚   â””â”€â”€ data    ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å†…å®¹ã¯zipãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€æ—¦å±•é–‹ã—ãŸã‚‚ã®ã®ãŸã‚çœç•¥
77 directories, 21 files
```

### å®Ÿè¡Œå¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã‚’ã¿ãªãŒã‚‰RDEToolKitã®ãƒ¢ãƒ¼ãƒ‰ã®å½¹å‰²ã«ã¤ã„ã¦èª¬æ˜
- `RDEFormat mode`ã§ã¯ã€äºˆã‚RDEã®å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«æ•´å½¢ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ä¸€å¼ã‚’zipãƒ•ã‚¡ã‚¤ãƒ«ã§ã¾ã¨ã‚ãŸã‚‚ã®ã‚’å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™
- RDEToolKitã¯ã€RDEFormat modeã®å ´åˆã¯ã€å…¥åŠ›ã•ã‚ŒãŸzipãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ§‹é€ åŒ–å‡¦ç†çµæœãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦é…ç½®ã—ã¾ã™
- RDEFormat modeã¯ã€å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ç§˜åŒ¿ã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’RDEã«ç™»éŒ²ã›ãšã«æ§‹é€ åŒ–å‡¦ç†çµæœã®ã¿ã‚’ç™»éŒ²ã™ã‚‹éš›ã®åˆ©ç”¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™
- ãªãŠãƒ•ã‚¡ã‚¤ãƒ«å±•é–‹å¾Œã¯å„ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦æ§‹é€ åŒ–å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™

## å…±é€šäº‹é …

### RDEToolKitãŒã©ã®ãƒ¢ãƒ¼ãƒ‰ã§å‹•ã„ã¦ã„ã‚‹ã‹ç¢ºèªã—ãŸã„

ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€RDEToolKitãŒãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«rdesys.logã‚’å‡ºåŠ›ã—ã¾ã™ã€‚\
dataãƒ•ã‚©ãƒ«ãƒ€ã‚’å¯¾è±¡ã«å®Ÿè¡Œã—ãŸå ´åˆã¯ä»¥ä¸‹ã®å ´æ‰€ã«ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãŒä¿å­˜ã•ã‚Œã¾ã™ã€‚

data/logs/rdesys.log

ä»¥ä¸‹ã¯ã€å‡ºåŠ›ã®äº‹ä¾‹ã§ã™ã€‚ã“ã®ä¾‹ã§ã¯Excelinvoiceãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œã—ãŸã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚
```
:
2025-09-30 14:09:42,317 - [rdetoolkit.processing.pipeline](INFO) - Starting pipeline execution for mode: Excelinvoice
:
```


ä»¥ä¸ŠãŒRDEã‚·ã‚¹ãƒ†ãƒ ã¸ã®ç™»éŒ²æ–¹æ³•5ç¨®é¡(5ã¤ã®mode)ã¨RDEToolKitã§ã®å®Ÿè£…æ–¹æ³•ã®èª¬æ˜ã¨ãªã‚Šã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã™ã‚‹ã¾ã§ã¯RDEToolKitãŒå®Ÿè¡Œã—ã¾ã™ã®ã§ã€ãã®å…ˆã®æ§‹é€ åŒ–å‡¦ç†ã‚’ãƒ—ãƒ­ã‚°ãƒ©ãƒ ä½œæˆã—ã¦ãã ã•ã„ã€‚

ä»¥ä¸Š
